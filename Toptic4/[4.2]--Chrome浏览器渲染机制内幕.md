# 浏览器渲染机制

## 浏览器发展历史
- 早期浏览器
  - 1990年第一个WWW浏览器
  - 文本界面浏览器
  - Telnet作为早期上网方式
    - 基于电话网络
    - 需要调制解调器(Modem)
- 重要浏览器演进
  - Mosaic(最早有影响力的浏览器)
    - 后改名为Netscape Navigator
    - 网景公司产品
  - Internet Explorer
    - 1995年推出IE3，与Windows 95捆绑
    - IE内核非微软自有，购买第三方使用权
  - Firefox
    - 源自Mozilla
    - Netscape开源后的产物
    - 第一个现代浏览器雏形
      - 插件系统
      - 收藏夹云同步
  - Safari(2003)
    - 使用WebKit内核
    - WebKit在2005年开源
  - Chrome(2008)
    - 基于WebKit开发Blink内核
    - 分为开源版(Chromium)和商业版(Chrome)
    
## 现代浏览器特征
- 基础功能
  - 网络功能
  - 资源管理(缓存等)
  - 页面浏览
- 多页面管理
  - Tab页功能
  - 多进程架构
    - 一个域名一个渲染进程
    - 提高稳定性
- 插件扩展系统
- 账户和同步功能
- 安全机制
  - 跨域限制
  - 安全沙箱
- 开发者工具

## 浏览器内部结构
- 用户界面层
  - 菜单
  - 工具栏
  - 地址栏等
- 浏览器引擎层
  - 负责UI和渲染引擎之间的交互
  - 处理各种浏览器功能
- 渲染引擎(浏览器核心)
  - 解析HTML/CSS/JavaScript
  - 排版
  - 显示
- 数据持久层
  - 本地存储
  - 缓存
  - Cookies
  - LocalStorage等
- 网络层
  - 实现HTTP/HTTPS等协议
- JavaScript引擎
  - 解析执行JavaScript代码
  
## Chrome浏览器架构
- 多进程架构
  - 浏览器主进程
    - 负责界面显示
    - 文件管理
    - 网络请求
  - 渲染进程(多个)
    - 每个域名一个进程
    - 负责页面渲染
    - 包含多个线程
  - GPU进程(单个)
    - 处理GPU任务
    - 3D绘制
  - 插件进程(多个)
    - 运行浏览器插件
    - 每个插件独立进程
  - 工具进程
    - 执行一些工具性任务

## 渲染流程
- HTML解析
  - 构建DOM树
  - 解析过程中遇到JS会暂停
- CSS解析
  - 构建CSSOM
  - 生成样式规则
- 合成渲染树
  - 将DOM和CSSOM结合
  - 计算元素样式
- 布局(Layout)
  - 计算元素位置和大小
  - 生成布局树
- 绘制(Paint)
  - 将页面分层
  - 确定绘制顺序
  - 生成绘制指令
- 栅格化(Rasterize)
  - 将页面分成小块(tiles)
  - GPU加速处理
- 合成和显示
  - 合成层叠内容
  - 显示到屏幕

## WebKit架构
- WebKit核心组件
  - WebCore
    - 处理HTML/CSS等Web标准
    - 页面渲染
  - JSCore/V8
    - JavaScript引擎
    - Chrome使用V8替代JSCore
- 基础功能库
  - 网络库
  - 图形库
  - 音视频处理
  - 字体渲染等
- API层
  - 上层API(供浏览器调用)
  - 下层API(调用系统功能)